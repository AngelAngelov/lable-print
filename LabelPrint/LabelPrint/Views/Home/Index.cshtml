@{
    ViewData["Title"] = "Label Print";
}

<div class="row">
    <div class="col-md-6 offset-md-3">
        <h1 class="display-4 text-center">Здравейте!</h1>
        <form method="post" asp-controller="Print" asp-action="Print" class="row" id="templateForm">
            <div class="col-12 mb-3">
                <div>Клиент</div>
                <div>
                    <select class="form-control" id="client" name="ClientId">
                        @for (int i = 0; i < ViewBag.Clients.Count; i++)
                        {
                        <option value="@ViewBag.Clients[i].Id">@ViewBag.Clients[i].Name</option>
                        }
                    </select>
                </div>
            </div>
            <div class="col-12 mb-3">
                <div>Ключови думи</div>
                <div>
                    #name# - Име на клиента
                    #address# - Адрес за кореспонденция
                    #phone# - телефонен номер
                    #fax# - факс
                    #email# - ел. поща
                </div>
            </div>
            <div class="col-12 mb-3">
                <div>Шаблон</div>
                <div>
                    <input type="hidden" id="template" name="Template" />
                    <div id="editor"></div>
                </div>
            </div>
            <div class="w-100 text-center">
                <button type="submit" class="btn btn-primary">генерирай етикет</button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script>

        Quill.prototype.getHtml = function () {
            return this.container.querySelector('.ql-editor').innerHTML;
        };

        const $client = document.getElementById('client');
        const $template = document.getElementById('template');
        const $form = document.getElementById('templateForm');
        const quill = new Quill('#editor', {
            theme: 'snow'
        });

        quill.on('text-change', (delta, oldDelta, source) => {
            const html = quill.getHtml()
            $template.value = html;
            console.log($template.value);
        });

        //$form.on('submit', function ($event) {
        //    if ($event) {
        //        $event.preventDefault();
        //        $event.stopPropagation();
        //    }

        //    const data = {
        //        client: $client.val(),
        //        template: $template.val()
        //    };

        //    $.post("/api/print", data)
        //        .then((res) => {
        //            console.log(res);
        //        })
        //        .catch((error) => {
        //            console.error(error);
        //        })
        //})
    </script>
}
